import random
from datetime import datetime

DEBUGGERS_SANDBOXES = [
    # https://gist.github.com/atar-axis/b3e16ccf75852f7cb59a7e169be230b1
    "OLLYDBG.exe", "x32dbg.exe", "x64dbg.exe", "x96dbg.exe", "idag.exe", "idaw.exe", "idaq.exe", "windbg.exe",
    "ImmunityDebugger.exe", "dnSpy.exe",

    # https://www.sans.org/reading-room/whitepapers/forensics/detecting-malware-sandbox-evasion-techniques-36667
    "vmusrvc.exe", "vboxtray.exe", "vmtoolsd.exe", "df5serv.exe", "vboxservice.exe"
]

HEX_CHARS = "0123456789abcdef"
HEX_CHARS_UPPER = "0123456789ABCDEF"


def add_jitter(num: int, jitter_range: float = .05) -> float:
    return num + random.uniform(0, num * jitter_range)


def jitter(num: int, jitter_range: float = .05) -> float:
    rng = num * jitter_range
    return random.uniform(num - rng, num + rng)


def hash_djb2(input_str: str) -> int:
    """Source: http://www.cse.yorku.ca/~oz/hash.html"""
    result = 5381
    for x in input_str:
        result = ((result << 5) + result) + ord(x)
    return result & 0xFFFFFFFF


def delta_to_next_hour(time=None):
    if time is None:
        time = datetime.now()
    minutes = 60 - time.minute - 1
    seconds = 60 - time.second
    return minutes * 60 + (seconds - 1)
